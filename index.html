<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KC Perfumaria - Loja Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap');
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #ffeef8 0%, #f0e6ff 50%, #e6f3ff 100%);
            min-height: 100vh;
        }
        
        .luxury-header {
            background: linear-gradient(135deg, #2d1b69 0%, #8b5cf6 50%, #ec4899 100%);
            position: relative;
            overflow: hidden;
        }
        
        .luxury-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="sparkle" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.3)"/></pattern></defs><rect width="100" height="100" fill="url(%23sparkle)"/></svg>');
            opacity: 0.3;
        }
        
        .product-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .product-card:hover::before {
            left: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 25px 50px rgba(139, 92, 246, 0.3);
        }
        
        .floating-cart {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .floating-cart:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1001;
            overflow-y: auto;
        }
        
        .cart-sidebar.open {
            right: 0;
        }
        
        .brand-filter {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .brand-filter:hover {
            border-color: #8b5cf6;
            transform: translateY(-2px);
        }
        
        .brand-filter.active {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white;
            border-color: transparent;
        }
        
        .search-box {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(139, 92, 246, 0.2);
            transition: all 0.3s ease;
        }
        
        .search-box:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        
        .admin-btn {
            background: linear-gradient(135deg, #1f2937, #374151);
            transition: all 0.3s ease;
            cursor: pointer !important;
        }
        
        .admin-btn:hover {
            background: linear-gradient(135deg, #374151, #4b5563);
            transform: translateY(-2px);
            cursor: pointer !important;
        }
        
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 1002;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .admin-panel {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            margin: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(139, 92, 246, 0.2);
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            border-color: #8b5cf6;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #7c3aed, #db2777);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }
        
        .luxury-title {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #8b5cf6, #ec4899, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @media (max-width: 640px) {
            .cart-sidebar {
                width: 100vw;
                right: -100vw;
            }
            
            .floating-cart {
                width: 60px;
                height: 60px;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Header -->
    <header class="luxury-header text-white py-8 relative z-10">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center backdrop-filter backdrop-blur-lg">
                        <span class="text-2xl">üíé</span>
                    </div>
                    <div>
                        <h1 class="luxury-title text-4xl font-bold">KC Perfumaria</h1>
                        <p class="text-purple-200 flex items-center space-x-2">
                            <span>Beleza & Eleg√¢ncia</span>
                            <span id="sync-indicator" class="text-green-300 text-sm">üîÑ Sincronizado</span>
                        </p>
                    </div>
                </div>
                <button onclick="
                    var senha = prompt('üîê Digite a senha de administrador:');
                    if (senha === 'kc0310') {
                        document.getElementById('customer-view').style.display = 'none';
                        document.getElementById('admin-panel').style.display = 'block';
                        showToast('Bem-vindo ao painel administrativo! üëë', 'success');
                    } else if (senha !== null) {
                        showToast('Senha incorreta! Acesso negado. üö´', 'error');
                    }
                " 
                style="background: #6b7280; color: white; padding: 12px 24px; border-radius: 25px; border: none; cursor: pointer; font-weight: 500;"
                onmouseover="this.style.background='#3b82f6'"
                onmouseout="this.style.background='#6b7280'">
                    ‚öôÔ∏è Admin
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-12">
        <!-- Customer View -->
        <div id="customer-view">
            <!-- Search Section -->
            <div class="text-center mb-12">
                <h2 class="luxury-title text-3xl font-bold mb-6">Encontre sua Fragr√¢ncia Perfeita</h2>
                <div class="max-w-md mx-auto">
                    <input type="text" 
                           id="search-input" 
                           placeholder="üîç Buscar produtos..." 
                           class="search-box w-full p-4 rounded-full text-center text-lg">
                </div>
            </div>

            <!-- Brand Filters -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Nossas Marcas Exclusivas</h3>
                <div class="flex flex-wrap justify-center gap-4">
                    <button onclick="filterByBrand('todas')" 
                            class="brand-filter active px-8 py-4 rounded-full font-medium transition-all"
                            data-brand="todas">
                        ‚ú® Todas
                    </button>
                    <button onclick="filterByBrand('boticario')" 
                            class="brand-filter px-8 py-4 rounded-full font-medium transition-all"
                            data-brand="boticario">
                        üåø Botic√°rio
                    </button>
                    <button onclick="filterByBrand('mary-kay')" 
                            class="brand-filter px-8 py-4 rounded-full font-medium transition-all"
                            data-brand="mary-kay">
                        üíé Mary Kay
                    </button>
                    <button onclick="filterByBrand('eudora')" 
                            class="brand-filter px-8 py-4 rounded-full font-medium transition-all"
                            data-brand="eudora">
                        ‚ú® Eudora
                    </button>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="products-grid">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="admin-panel">
            <div class="text-center mb-8">
                <h2 class="luxury-title text-3xl font-bold mb-4">Painel Administrativo</h2>
                <button onclick="backToStore()" 
                        class="btn-primary text-white px-6 py-3 rounded-full font-medium">
                    üè™ Voltar para Loja
                </button>
            </div>

            <form id="add-product-form" class="max-w-2xl mx-auto space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="text" 
                           id="product-name" 
                           placeholder="Nome do produto" 
                           class="form-input w-full p-4 rounded-lg" 
                           required>
                    
                    <select id="product-brand" 
                            class="form-input w-full p-4 rounded-lg" 
                            required>
                        <option value="">Selecione a marca</option>
                        <option value="boticario">üåø Botic√°rio</option>
                        <option value="mary-kay">üíé Mary Kay</option>
                        <option value="eudora">‚ú® Eudora</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <select id="product-category" 
                            class="form-input w-full p-4 rounded-lg" 
                            required>
                        <option value="">Categoria</option>
                        <option value="perfumes">Perfumes</option>
                        <option value="cosmeticos">Cosm√©ticos</option>
                        <option value="cuidados">Cuidados</option>
                    </select>
                    
                    <input type="number" 
                           id="product-price" 
                           placeholder="Pre√ßo (R$)" 
                           step="0.01" 
                           min="0"
                           class="form-input w-full p-4 rounded-lg" 
                           required>
                    
                    <input type="number" 
                           id="product-stock" 
                           placeholder="Estoque" 
                           min="0"
                           class="form-input w-full p-4 rounded-lg" 
                           required>
                </div>

                <textarea id="product-description" 
                          placeholder="Descri√ß√£o do produto" 
                          class="form-input w-full p-4 rounded-lg h-32"></textarea>
                
                <button type="submit" 
                        class="btn-primary w-full text-white py-4 rounded-lg font-semibold text-lg">
                    ‚ú® Adicionar Produto
                </button>
            </form>
        </div>
    </div>

    <!-- Floating Cart Button -->
    <div class="floating-cart" onclick="toggleCart()">
        <div class="relative">
            <span class="text-2xl">üõí</span>
            <span class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold" id="cart-count">0</span>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="cart-sidebar">
        <div class="p-6 border-b border-gray-200">
            <div class="flex justify-between items-center">
                <h3 class="text-2xl font-bold text-gray-800">Seu Carrinho</h3>
                <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700 text-3xl">
                    &times;
                </button>
            </div>
        </div>
        
        <div class="flex-1 p-6">
            <div id="cart-items">
                <div class="text-center py-16 text-gray-500">
                    <div class="text-6xl mb-4">üõí</div>
                    <p class="text-xl">Carrinho vazio</p>
                    <p class="text-sm mt-2">Adicione produtos incr√≠veis!</p>
                </div>
            </div>
        </div>
        
        <div class="p-6 border-t border-gray-200">
            <div class="flex justify-between items-center mb-6">
                <span class="text-xl font-semibold">Total:</span>
                <span class="text-2xl font-bold text-purple-600" id="cart-total">R$ 0,00</span>
            </div>
            <button onclick="finalizePurchaseWhatsApp()" 
                    id="checkout-btn"
                    class="btn-primary w-full text-white py-4 rounded-lg font-semibold text-lg disabled:opacity-50"
                    disabled>
                üì± Finalizar no WhatsApp
            </button>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="overlay" onclick="toggleCart()"></div>

    <script>
        // Configuration
        const CONFIG = {
            ADMIN_PASSWORD: 'kc0310',
            WHATSAPP_NUMBER: '5541997786625',
            SYNC_CHANNEL: 'kc_perfumaria_sync'
        };

        // Global state
        let products = [];
        let cart = [];
        let currentBrand = 'todas';

        // Utility functions
        function formatPrice(price) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(price);
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, 3000);
        }

        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function getRandomEmoji() {
            const emojis = ['üå∏', 'üíÑ', 'üß¥', '‚ú®', 'üíé', 'üå∫', 'üéÄ', 'üíã', 'üå∑', 'ü¶ã'];
            return emojis[Math.floor(Math.random() * emojis.length)];
        }

        // Cart functions
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) {
                showToast('Produto indispon√≠vel no momento', 'error');
                return;
            }

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                } else {
                    showToast('Quantidade m√°xima atingida', 'error');
                    return;
                }
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    image: product.image
                });
            }
            
            // Update stock in real-time
            product.stock--;
            
            updateCartDisplay();
            renderProducts(); // Refresh to show updated stock
            showToast(`${product.name} adicionado ao carrinho! ‚ú®`, 'success');
            
            // Broadcast stock update to other devices
            broadcastUpdate('STOCK_UPDATED', {
                productId: productId,
                newStock: product.stock
            });
            
            saveData(false); // Don't broadcast full product list, just stock update
        }

        function removeFromCart(productId) {
            const item = cart.find(item => item.id === productId);
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
            showToast(`${item.name} removido do carrinho`, 'info');
            saveData();
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                    return;
                }
            }
            updateCartDisplay();
            saveData();
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotal = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-btn');

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            cartCount.textContent = totalItems;
            cartTotal.textContent = formatPrice(totalPrice);
            checkoutBtn.disabled = cart.length === 0;

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center py-16 text-gray-500">
                        <div class="text-6xl mb-4">üõí</div>
                        <p class="text-xl">Carrinho vazio</p>
                        <p class="text-sm mt-2">Adicione produtos incr√≠veis!</p>
                    </div>
                `;
                return;
            }

            cartItems.innerHTML = cart.map(item => `
                <div class="flex items-center justify-between py-4 border-b border-gray-100">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-100 to-pink-100 rounded-lg flex items-center justify-center text-xl">
                            ${item.image}
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">${item.name}</h4>
                            <p class="text-purple-600 font-bold">${formatPrice(item.price)}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="updateQuantity(${item.id}, -1)" 
                                class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors">
                            -
                        </button>
                        <span class="w-8 text-center font-semibold">${item.quantity}</span>
                        <button onclick="updateQuantity(${item.id}, 1)" 
                                class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors">
                            +
                        </button>
                        <button onclick="removeFromCart(${item.id})" 
                                class="ml-2 text-red-500 hover:text-red-700 transition-colors">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function toggleCart() {
            const sidebar = document.getElementById('cart-sidebar');
            const overlay = document.getElementById('overlay');
            
            const isOpen = sidebar.classList.contains('open');
            
            if (isOpen) {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
                document.body.style.overflow = '';
            } else {
                sidebar.classList.add('open');
                overlay.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function finalizePurchaseWhatsApp() {
            if (cart.length === 0) return;

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            let message = `‚ú® *PEDIDO KC PERFUMARIA* üíé\n\n`;
            message += `üõçÔ∏è *PRODUTOS SELECIONADOS:*\n`;
            
            cart.forEach((item, index) => {
                message += `${index + 1}. ${item.name}\n`;
                message += `   Quantidade: ${item.quantity}x\n`;
                message += `   Valor: ${formatPrice(item.price * item.quantity)}\n\n`;
            });
            
            message += `üí∞ *TOTAL: ${formatPrice(total)}*\n\n`;
            message += `Ol√°! Gostaria de finalizar este pedido. Podemos conversar sobre a entrega? üòä`;

            const whatsappUrl = `https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');

            cart = [];
            updateCartDisplay();
            toggleCart();
            showToast('Pedido enviado com sucesso! üéâ', 'success');
            saveData();
        }

        // Filter functions
        function filterByBrand(brand) {
            currentBrand = brand;
            
            document.querySelectorAll('.brand-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[data-brand="${brand}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            renderProducts();
        }

        // Product functions
        function renderProducts() {
            const grid = document.getElementById('products-grid');
            
            let filtered = [...products];
            
            if (currentBrand !== 'todas') {
                filtered = filtered.filter(p => p.brand === currentBrand);
            }

            const brandNames = {
                'boticario': 'üåø Botic√°rio',
                'mary-kay': 'üíé Mary Kay',
                'eudora': '‚ú® Eudora'
            };

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="text-8xl mb-6">üîç</div>
                        <h3 class="text-2xl font-semibold text-gray-600 mb-2">Nenhum produto encontrado</h3>
                        <p class="text-gray-500">Tente ajustar os filtros de busca</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(product => `
                <div class="product-card rounded-2xl p-6 text-center">
                    <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center text-3xl">
                        ${product.image}
                    </div>
                    <div class="text-sm text-purple-600 font-semibold mb-2">
                        ${brandNames[product.brand] || product.brand}
                    </div>
                    <h3 class="font-bold text-xl mb-3 text-gray-800">${product.name}</h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description || ''}</p>
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-2xl font-bold text-purple-600">${formatPrice(product.price)}</span>
                        <span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                            Estoque: ${product.stock}
                        </span>
                    </div>
                    <button onclick="addToCart(${product.id})" 
                            ${product.stock === 0 ? 'disabled' : ''}
                            class="w-full py-3 px-6 rounded-xl font-semibold transition-all
                            ${product.stock === 0 
                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                : 'btn-primary text-white'}">
                        ${product.stock === 0 ? '‚ùå Sem Estoque' : '‚ú® Adicionar ao Carrinho'}
                    </button>
                </div>
            `).join('');
        }

        // Admin functions
        function accessAdmin() {
            console.log('Admin button clicked'); // Debug
            const password = prompt('üîê Digite a senha de administrador:');
            
            if (password === CONFIG.ADMIN_PASSWORD) {
                document.getElementById('customer-view').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                showToast('Bem-vindo ao painel administrativo! üëë', 'success');
            } else if (password !== null) {
                showToast('Senha incorreta! Acesso negado. üö´', 'error');
            }
        }

        function backToStore() {
            document.getElementById('customer-view').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            showToast('Voltando para a loja... üè™', 'info');
        }

        // Real-time sync system
        let syncChannel;
        
        function initSync() {
            // Create broadcast channel for real-time sync
            syncChannel = new BroadcastChannel(CONFIG.SYNC_CHANNEL);
            
            // Listen for updates from other tabs/devices
            syncChannel.addEventListener('message', (event) => {
                const { type, data, timestamp } = event.data;
                
                // Prevent sync loops
                if (timestamp && Date.now() - timestamp < 100) return;
                
                switch (type) {
                    case 'PRODUCTS_UPDATED':
                        products = data.products;
                        renderProducts();
                        showToast('üì± Produtos atualizados em tempo real!', 'info');
                        break;
                    case 'CART_UPDATED':
                        // Only sync cart if it's from admin actions, not user actions
                        break;
                    case 'STOCK_UPDATED':
                        updateStockFromSync(data);
                        break;
                }
                
                // Update localStorage without triggering another sync
                localStorage.setItem('kc_perfumaria_data', JSON.stringify({ products, cart }));
            });
        }
        
        function broadcastUpdate(type, data) {
            if (syncChannel) {
                syncChannel.postMessage({
                    type,
                    data,
                    timestamp: Date.now()
                });
            }
        }
        
        function updateStockFromSync(data) {
            const product = products.find(p => p.id === data.productId);
            if (product) {
                product.stock = data.newStock;
                renderProducts();
                showToast(`üì¶ Estoque atualizado: ${product.name}`, 'info');
            }
        }

        // Data persistence with sync
        function saveData(broadcast = true) {
            localStorage.setItem('kc_perfumaria_data', JSON.stringify({ products, cart }));
            
            if (broadcast && syncChannel) {
                broadcastUpdate('PRODUCTS_UPDATED', { products });
            }
        }

        function loadData() {
            const saved = localStorage.getItem('kc_perfumaria_data');
            if (saved) {
                const data = JSON.parse(saved);
                products = data.products || [];
                cart = data.cart || [];
            }
            
            if (products.length === 0) {
                loadSampleData();
            }
        }

        function loadSampleData() {
            products = [
                {
                    id: 1,
                    name: 'Malbec Absoluto',
                    brand: 'boticario',
                    category: 'perfumes',
                    price: 129.90,
                    stock: 15,
                    description: 'Perfume masculino amadeirado com notas intensas e marcantes',
                    image: 'üåø'
                },
                {
                    id: 2,
                    name: 'Base TimeWise 3D',
                    brand: 'mary-kay',
                    category: 'cosmeticos',
                    price: 89.00,
                    stock: 12,
                    description: 'Base l√≠quida com cobertura natural e prote√ß√£o anti-idade',
                    image: 'üíé'
                },
                {
                    id: 3,
                    name: 'Batom L√≠quido Glam',
                    brand: 'eudora',
                    category: 'cosmeticos',
                    price: 39.90,
                    stock: 25,
                    description: 'Batom l√≠quido matte com alta pigmenta√ß√£o e longa dura√ß√£o',
                    image: '‚ú®'
                },
                {
                    id: 4,
                    name: 'Lily Eau de Parfum',
                    brand: 'boticario',
                    category: 'perfumes',
                    price: 159.90,
                    stock: 8,
                    description: 'Fragr√¢ncia feminina floral sofisticada e envolvente',
                    image: 'üå∏'
                }
            ];
            saveData();
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                
                if (!term) {
                    renderProducts();
                    return;
                }
                
                const filtered = products.filter(product => 
                    product.name.toLowerCase().includes(term) ||
                    product.description?.toLowerCase().includes(term) ||
                    product.brand.toLowerCase().includes(term)
                );
                
                const grid = document.getElementById('products-grid');
                
                if (filtered.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center py-20">
                            <div class="text-8xl mb-6">üîç</div>
                            <h3 class="text-2xl font-semibold text-gray-600 mb-2">Nenhum resultado para "${term}"</h3>
                            <p class="text-gray-500">Tente buscar por outros termos</p>
                        </div>
                    `;
                } else {
                    // Render filtered products
                    const brandNames = {
                        'boticario': 'üåø Botic√°rio',
                        'mary-kay': 'üíé Mary Kay',
                        'eudora': '‚ú® Eudora'
                    };

                    grid.innerHTML = filtered.map(product => `
                        <div class="product-card rounded-2xl p-6 text-center">
                            <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center text-3xl">
                                ${product.image}
                            </div>
                            <div class="text-sm text-purple-600 font-semibold mb-2">
                                ${brandNames[product.brand] || product.brand}
                            </div>
                            <h3 class="font-bold text-xl mb-3 text-gray-800">${product.name}</h3>
                            <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description || ''}</p>
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-2xl font-bold text-purple-600">${formatPrice(product.price)}</span>
                                <span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                                    Estoque: ${product.stock}
                                </span>
                            </div>
                            <button onclick="addToCart(${product.id})" 
                                    ${product.stock === 0 ? 'disabled' : ''}
                                    class="w-full py-3 px-6 rounded-xl font-semibold transition-all
                                    ${product.stock === 0 
                                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                        : 'btn-primary text-white'}">
                                ${product.stock === 0 ? '‚ùå Sem Estoque' : '‚ú® Adicionar ao Carrinho'}
                            </button>
                        </div>
                    `).join('');
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Comprehensive error suppression for browser extensions
            const originalConsoleError = console.error;
            console.error = function(...args) {
                const message = args.join(' ');
                if (message.includes('message channel closed') || 
                    message.includes('listener indicated an asynchronous response') ||
                    message.includes('sw_iframe.html') ||
                    message.includes('Extension context invalidated')) {
                    return; // Suppress extension errors
                }
                originalConsoleError.apply(console, args);
            };
            
            // Prevent extension errors
            window.addEventListener('error', function(e) {
                if (e.message && (e.message.includes('message channel closed') || 
                    e.message.includes('listener indicated an asynchronous response') ||
                    e.message.includes('sw_iframe.html'))) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            }, true);
            
            // Prevent unhandled promise rejections from extensions
            window.addEventListener('unhandledrejection', function(e) {
                if (e.reason && e.reason.message && (
                    e.reason.message.includes('message channel closed') ||
                    e.reason.message.includes('listener indicated an asynchronous response') ||
                    e.reason.message.includes('sw_iframe.html'))) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            }, true);
            
            loadData();
            initSync(); // Initialize real-time sync
            renderProducts();
            updateCartDisplay();
            setupSearch();
            
            // Admin button is now handled inline
            
            // Form handler
            document.getElementById('add-product-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('product-name').value.trim();
                const brand = document.getElementById('product-brand').value;
                const category = document.getElementById('product-category').value;
                const price = parseFloat(document.getElementById('product-price').value);
                const stock = parseInt(document.getElementById('product-stock').value);
                const description = document.getElementById('product-description').value.trim();
                
                if (!name || !brand || !category || isNaN(price) || isNaN(stock)) {
                    showToast('Por favor, preencha todos os campos obrigat√≥rios! üìù', 'error');
                    return;
                }
                
                const product = {
                    id: generateId(),
                    name,
                    brand,
                    category,
                    price,
                    stock,
                    description,
                    image: getRandomEmoji()
                };
                
                products.push(product);
                saveData();
                renderProducts();
                
                e.target.reset();
                showToast(`${name} adicionado com sucesso! ‚ú®`, 'success');
            });
            
            showToast('KC Perfumaria carregada com sucesso! üíé', 'success');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96ec541b128352c4',t:'MTc1NTEzMTI2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
